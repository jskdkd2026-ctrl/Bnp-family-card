<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>BNP Mission 2026</title>
    <style>
        :root { --primary: #2e7d32; --danger: #ff1744; --gold: #ffd700; --bg: #0d0d0d; }
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); touch-action: manipulation; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { display: block; background: linear-gradient(180deg, #0f2027, #2c5364); }
        
        #ui-layer { position: absolute; top: 0; width: 100%; padding: 15px; display: flex; flex-direction: column; align-items: center; z-index: 10; pointer-events: none; }
        .instruction-box { background: rgba(0,0,0,0.85); color: #fff; padding: 10px 20px; border-radius: 30px; border: 2px solid var(--gold); font-size: 16px; font-weight: bold; margin-bottom: 5px; text-align: center; min-width: 280px; }
        .stat-box { background: rgba(0,0,0,0.85); color: var(--gold); padding: 8px 25px; border-radius: 12px; border: 2px solid var(--gold); font-size: 24px; font-weight: 900; }
        
        #startScreen, #gameOverScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; color: white; text-align: center; padding: 20px; box-sizing: border-box; }
        
        @keyframes intenseShake {
            0% { transform: translate(3px, 3px); }
            50% { transform: translate(-4px, -2px); }
            100% { transform: translate(2px, 3px); }
        }
        .dholai-text { font-size: 45px; margin: 0; font-weight: 900; color: var(--danger); }
        .dholai-emojis { font-size: 55px; margin-top: 10px; animation: intenseShake 0.1s infinite; display: inline-block; }

        .msg-box { padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 8px solid; text-align: left; background: rgba(255,255,255,0.1); width: 100%; max-width: 400px; font-size: 14px; }
        .kormi-msg { border-color: var(--primary); }
        .jonogon-msg { border-color: var(--danger); }

        .btn-main { background: linear-gradient(45deg, #1b5e20, #388e3c); color: white; padding: 15px 45px; font-size: 20px; border: none; border-radius: 50px; cursor: pointer; font-weight: 900; margin-top: 15px; }
        #controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; z-index: 20; }
        .jump-btn { width: 95px; height: 95px; background: rgba(255,255,255,0.1); border: 3px solid white; border-radius: 50%; color: white; display: flex; justify-content: center; align-items: center; font-weight: 900; backdrop-filter: blur(5px); cursor: pointer; }
    </style>
</head>
<body>

<audio id="bgm" loop preload="auto"><source src="bgm.mp3" type="audio/mpeg"></audio>
<audio id="chandaVoice" preload="auto"><source src="chanda_de.mp3" type="audio/mpeg"></audio>
<audio id="hashi" preload="auto"><source src="hashi.mp3" type="audio/mpeg"></audio>
<audio id="planVoice" preload="auto"><source src="plan_dialogue.mp3" type="audio/mpeg"></audio>
<audio id="tarekVoice" preload="auto"><source src="tarek_voice.mp3" type="audio/mpeg"></audio>

<div id="ui-layer">
    <div id="instruction" class="instruction-box">‡¶®‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®</div>
    <div class="stat-box">üí∞ <span id="score">0</span></div>
</div>

<div id="startScreen">
    <h1 style="font-size: 40px; color: var(--gold); margin: 0;">WE HAVE A PLAN</h1>
    <button class="btn-main" onclick="startGame()">START MISSION</button>
</div>

<div id="gameOverScreen" style="display: none;">
    <h1 class="dholai-text">‡¶ß‡ßã‡¶≤‡¶æ‡¶á ‡¶∂‡ßÅ‡¶∞‡ßÅ!</h1>
    <div class="dholai-emojis">ü•ä üëä üí¢ üëä</div>
    
    <div class="msg-box kormi-msg">
        <b style="color:var(--gold);">BNP KORMI:</b><br>
        <span>"‡¶§‡¶æ‡¶∞‡ßá‡¶ï ‡¶ú‡¶ø‡ßü‡¶æ‡¶∞ We Have A Plan ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡¶æ‡ßü‡¶® ‡¶ï‡¶∞‡¶§‡ßá‡¶õ‡¶ø ‡¶Ü‡¶Æ‡¶∞‡¶æ, ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶Æ‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ! üò≠üôè"</span>
    </div>
    <div class="msg-box jonogon-msg">
        <b style="color:var(--gold);">JONOGON:</b><br>
        <span>"‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶™‡ßÅ‡¶ü‡¶ï‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶≠‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã! üñïüò°ü§¨"</span>
    </div>
    
    <button class="btn-main" onclick="resetGame()">TRY AGAIN</button>
</div>

<div id="controls"><div class="jump-btn" id="jumpBtn">JUMP</div></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const instructionEl = document.getElementById('instruction');
const bgm = document.getElementById('bgm');

function resize() {
    canvas.width = window.innerWidth > 600 ? 600 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

let audioCtx;
bgm.volume = 0.2;

function initAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playSound(id) {
    const el = document.getElementById(id);
    if (el) { el.currentTime = 0; el.play().catch(e => {}); }
}

function stopAllSounds() {
    ['bgm', 'chandaVoice', 'hashi', 'tarekVoice'].forEach(id => {
        const s = document.getElementById(id);
        if(s) { s.pause(); s.currentTime = 0; }
    });
}

function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
    ctx.beginPath();
    ctx.moveTo(x + radius, y); ctx.lineTo(x + width - radius, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    ctx.lineTo(x + radius, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
    ctx.lineTo(x, y + radius); ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
    if (fill) { ctx.fillStyle = fill; ctx.fill(); }
    if (stroke) { ctx.strokeStyle = stroke; ctx.lineWidth = 2; ctx.stroke(); }
}

const baseSpeed = 4.5;
let score = 0, currentChanda = 0, gameSpeed = baseSpeed, gameActive = false, frame = 0;
let tarekActive = false, tarekX = -300, cardDropped = false, droppedCard = null, pointTaken = false;
const groundHeight = 100;

const player = { x: 60, y: 0, w: 75, h: 95, dy: 0, jumpPower: -20, gravity: 0.7, grounded: false, state: 'normal', timer: 0 };
let obstacles = [];

function startGame() {
    initAudio();
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('gameOverScreen').style.display = 'none';
    gameActive = true;
    bgm.play();
    requestAnimationFrame(loop);
}

function resetGame() {
    stopAllSounds();
    score = 0; currentChanda = 0; gameSpeed = baseSpeed; frame = 0;
    scoreEl.innerText = "0"; obstacles = [];
    tarekActive = false; tarekX = -300; cardDropped = false; droppedCard = null; pointTaken = false;
    player.y = 0; player.dy = 0; player.state = 'normal';
    instructionEl.innerText = "‡¶®‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®";
    startGame();
}

function spawn() {
    if (tarekActive || droppedCard) return;
    const isEnemy = Math.random() < 0.35;
    const types = [{n:'‡¶∏‡¶ø‡¶è‡¶®‡¶ú‡¶ø ‡¶Æ‡¶æ‡¶Æ‡¶æ', i:'üõ∫'}, {n:'‡¶∞‡¶ø‡¶ï‡¶∂‡¶æ ‡¶Æ‡¶æ‡¶Æ‡¶æ', i:'üö≤'}, {n:'‡¶ö‡¶æ ‡¶Æ‡¶æ‡¶Æ‡¶æ', i:'‚òï'}];
    const type = types[Math.floor(Math.random() * types.length)];
    const randomY = Math.random() > 0.6 ? canvas.height - groundHeight - 195 : canvas.height - groundHeight - 85;

    obstacles.push({
        x: canvas.width, y: randomY, w: 85, h: 85,
        isEnemy, name: isEnemy ? '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ú‡¶®‡¶ó‡¶£' : type.n, icon: isEnemy ? 'üëÆ‚Äç‚ôÇÔ∏è' : type.i, speed: gameSpeed
    });
}

function update() {
    if(!gameActive) return;
    player.dy += player.gravity; player.y += player.dy;
    if (player.y + player.h > canvas.height - groundHeight) {
        player.y = canvas.height - groundHeight - player.h;
        player.dy = 0; player.grounded = true;
    }

    if (player.timer > 0) { player.timer--; if(player.timer === 0) player.state = 'normal'; }

    // Tarek Zia Spawn
    if (currentChanda >= 5000 && !tarekActive) {
        tarekActive = true; tarekX = -200; cardDropped = false; pointTaken = false;
        instructionEl.innerText = "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡ßá ‡¶π‡¶æ‡¶§‡ßá ‡¶´‡ßç‡¶Ø‡¶æ‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡ßá ‡¶∏‡¶æ‡¶•‡ßá";
        playSound('tarekVoice');
    }

    if (tarekActive) {
        tarekX += 2.5; 
        
        // ‡ßß. ‡¶§‡¶æ‡¶∞‡ßá‡¶ï ‡¶Ø‡¶ñ‡¶®‡¶á ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞‡¶ï‡ßá ‡¶ï‡ßç‡¶∞‡¶∏ ‡¶ï‡¶∞‡¶¨‡ßá, ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ó‡¶æ‡ßü‡ßá‡¶¨ ‡¶π‡¶¨‡ßá
        if (tarekX >= player.x && !pointTaken) {
            score -= currentChanda; // ‡¶Æ‡ßá‡¶á‡¶® ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶•‡ßá‡¶ï‡ßá‡¶ì ‡¶ì‡¶á ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶á‡¶®‡¶æ‡¶∏
            if(score < 0) score = 0;
            currentChanda = 0; 
            scoreEl.innerText = score;
            pointTaken = true;
            playSound('hashi');
        }

        // ‡ß®. ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶°‡ßç‡¶∞‡¶™ ‡¶π‡¶¨‡ßá ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü (‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶°‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶§‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡¶æ‡¶ï‡¶æ‡¶õ‡¶ø)
        if (tarekX > canvas.width - 150 && !cardDropped) {
            droppedCard = { x: tarekX, y: canvas.height - groundHeight - 100, w: 125, h: 80 };
            cardDropped = true;
        }
        
        if (tarekX > canvas.width + 120) tarekActive = false;
    }

    if (droppedCard) {
        droppedCard.x -= 2;
        if (player.x < droppedCard.x + droppedCard.w && player.x + player.w > droppedCard.x &&
            player.y < droppedCard.y + droppedCard.h && player.y + player.h > droppedCard.y) {
            score += 250; 
            scoreEl.innerText = score;
            gameSpeed += 0.6;
            player.state = 'happy'; player.timer = 100;
            instructionEl.innerText = "‡¶®‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®";
            droppedCard = null;
        } else if (droppedCard.x < -150) {
            droppedCard = null;
            instructionEl.innerText = "‡¶®‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡ß´‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®";
        }
    }

    obstacles.forEach((obs, i) => {
        obs.x -= obs.speed;
        if (player.x < obs.x + obs.w && player.x + player.w > obs.x &&
            player.y < obs.y + obs.h && player.y + player.h > obs.y) {
            if (obs.isEnemy) {
                gameActive = false; stopAllSounds(); playSound('planVoice');
                document.getElementById('gameOverScreen').style.display = 'flex';
            } else {
                score += 500; currentChanda += 500;
                scoreEl.innerText = score;
                player.state = 'laughing'; player.timer = 50;
                playSound('chandaVoice');
                obstacles.splice(i, 1);
            }
        }
        if (obs.x < -150) obstacles.splice(i, 1);
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#111'; ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);
    
    // Player
    const pColor = player.state === 'normal' ? '#1b5e20' : '#2e7d32';
    roundRect(ctx, player.x, player.y, player.w, player.h, 12, pColor, 'white');
    ctx.textAlign = "center"; ctx.font = "45px Arial";
    ctx.fillText(player.state === 'happy' ? "üòç" : (player.state === 'laughing' ? "üòÇ" : "üåæ"), player.x + player.w/2, player.y + 65);
    
    ctx.fillStyle = "white"; ctx.font = "bold 13px Arial";
    let playerDialogue = "‡¶ö‡¶æ‡¶®‡ßç‡¶¶‡¶æ ‡¶¶‡ßá!";
    if (player.state === 'laughing') playerDialogue = "‡¶π‡¶æ ‡¶π‡¶æ ‡¶π‡¶æ!";
    if (player.state === 'happy') playerDialogue = "‡¶™‡ßá‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡¶ø!";
    ctx.fillText(playerDialogue, player.x + player.w/2, player.y - 12);

    // Tarek Zia
    if (tarekActive) {
        roundRect(ctx, tarekX, canvas.height - groundHeight - 120, 100, 120, 10, 'white', '#ffd700');
        ctx.font = "48px Arial"; ctx.fillText("üï∂Ô∏è", tarekX + 50, canvas.height - groundHeight - 45);
        ctx.fillStyle = "#b71c1c"; ctx.font = "bold 13px Arial"; 
        ctx.fillText("TAREK ZIA", tarekX + 50, canvas.height - groundHeight - 20);
        ctx.fillStyle = "white"; ctx.font = "bold 13px Arial";
        ctx.fillText("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡ßá ‡¶π‡¶æ‡¶§‡ßá", tarekX + 50, canvas.height - groundHeight - 145);
        ctx.fillText("‡¶´‡ßç‡¶Ø‡¶æ‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡ßá ‡¶∏‡¶æ‡¶•‡ßá", tarekX + 50, canvas.height - groundHeight - 130);
    }

    // Family Card
    if (droppedCard) {
        roundRect(ctx, droppedCard.x, droppedCard.y, droppedCard.w, droppedCard.h, 10, 'gold', 'white');
        ctx.fillStyle = "black"; ctx.font = "bold 15px Arial"; 
        ctx.fillText("FAMILY CARD", droppedCard.x + 62, droppedCard.y + 35);
        ctx.font = "32px Arial"; ctx.fillText("üí≥", droppedCard.x + 62, droppedCard.y + 65);
    }

    // Obstacles
    obstacles.forEach(obs => {
        const obsColor = obs.isEnemy ? '#b71c1c' : '#fbc02d';
        roundRect(ctx, obs.x, obs.y, obs.w, obs.h, 12, obsColor, 'white');
        ctx.fillStyle = "white"; ctx.font = "bold 14px Arial"; ctx.fillText(obs.name, obs.x + obs.w/2, obs.y - 12);
        ctx.font = "48px Arial"; ctx.fillText(obs.icon, obs.x + obs.w/2, obs.y + 58);
    });
}

function loop() {
    if (!gameActive) return;
    update(); draw(); frame++;
    if (frame % 115 === 0) spawn();
    requestAnimationFrame(loop);
}

function jump() { 
    initAudio();
    if (player.grounded && gameActive) { player.dy = player.jumpPower; player.grounded = false; } 
}

document.getElementById('jumpBtn').addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });
window.addEventListener('keydown', (e) => { if(e.code === 'Space') jump(); });
</script>
</body>
</html>
